const fs = require("fs-extra");
const path = require("path");

module.exports.config = {
    name: "ØªØ§Ø¬",
    version: "1.0.1",
    hasPermssion: 0,
    credits: "ChatGPT",
    description: "ØªØ§Ø¬ ØªÙ„Ù‚Ø§Ø¦ÙŠ ÙƒÙ„ 15 Ø«Ø§Ù†ÙŠØ©",
    commandCategory: "Ø®Ø¯Ù…Ø§Øª",
    usages: "ØªØ§Ø¬",
    cooldowns: 0
};

const dataPath = path.join(__dirname, "..", "..", "hitler.js");
const tagText = `ð´.R  â”‹AI bot â”‹ 
Ø§Ù„Ø±Ø¯ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ 
*ð—”ð˜‚ð˜ð—¼ ð—¥ð—²ð—½ð—¹ð˜†*

Ø±Ø¯ Ø¢Ù„ÙŠ
ð—”ð˜‚ð˜ð—¼ ð—¥ð—²ð—½ð—¹ð˜†
ð™† â†’â”Šâœ˜â”Šâ†’ ð™Ž â†’â”Š â˜ ï¸Žï¸Ž â”Šâ†’ ð™ˆ â†’â”Šâœ˜â”Šâ†’ ð™† â†’â”Š â˜ ï¸Žï¸Ž â”Šâ†’ ð™‰ â†’â”Šâœ˜â”Šâ†’ ð™† â†’â”Š â˜ ï¸Žï¸Ž â”Šâ†’ ð™ˆ â†’ ð™†â”Šâœ˜â”Šð™† â†’â”Š â˜ ï¸Žï¸Ž â”Šâ†’ ð™Ž â†’â”Š â˜ ï¸Žï¸Ž â”Šâ†’ ð™ˆ â†’â”Šâœ˜â”Šâ†’ ð™† â†’â”Š â˜ ï¸Žï¸Ž â”Šâ†’ ð™‰ â†’â”Šâœ˜â”Šâ†’ ð™† â†’â”Š â˜ ï¸Žï¸Ž â”Šâ†’ ð™ˆ â†’ ð™†â”Š â˜ ï¸Žï¸Ž â”Šð™† â†’â”Š â˜ ï¸Žï¸Ž â”Š â†’ ð™Ž â†’â”Šâœ˜â”Šâ†’ ð™ˆ â†’â”Š â˜ ï¸Žï¸Ž â”Šâ†’ ð™† â†’â”Šâœ˜â”Šâ†’ ð™‰ â†’â”Š â˜ ï¸Žï¸Ž â”Šâ†’ ð™† â†’â”Šâœ˜â”Šâ†’ ð™ˆ â†’ ð™†â”Š â˜ ï¸Žï¸Ž â”Šð™† â†’â”Šâœ˜â”Šâ†’ ð™Ž â†’â”Š â˜ ï¸Žï¸Ž â”Šâ†’ ð™ˆ â†’â”Š â˜ ï¸Žï¸Ž â”Šâ†’ ð™† â†’â”Š â˜ ï¸Žï¸Ž â”Šâ†’ ð™‰ â†’â”Šâœ˜â”Šâ†’ ð™† â†’â”Š â˜ ï¸Žï¸Ž â”Šâ†’ ð™ˆ â†’ ð™†â”Šâœ˜â”Šð™† â†’â”Š â˜ ï¸Žï¸Ž â”Šâ†’ ð™Ž â†’â”Š â˜ ï¸Žï¸Ž â”Šâ†’ ð™ˆ â†’â”Š â˜ ï¸Žï¸Ž â”Šâ†’ ð™† 
ð™† â†’â”Šâœ˜â”Šâ†’ ð™Ž â†’â”Š â˜ ï¸Žï¸Ž â”Šâ†’ ð™ˆ â†’â”Šâœ˜â”Šâ†’ â†’â”Š â˜ ï¸Žï¸Ž â”Šâ†’ ð™ˆ â†’ ð™†â”Šâœ˜â”Šð™† â†’â”Š â˜ ï¸Žï¸Ž â”Šâ†’ ð™Ž â†’â”Š â˜ ï¸Žï¸Ž â”Šâ†’ ð™ˆ â†’â”Š â˜ ï¸Žï¸Ž â”Šâ†’ ð™† â†’â”Šâ”Šâ†’ ð™‰ â†’â”Š â˜ ï¸Žï¸ŽáŸµâ˜¬
   
ð¦ð¢ð¥ð¢ð­ð¢ðš ð¥ðžðšððžð« ð…ðšðœðžð›ð¨ð¨ð¤ðŸ•¸ðŸ«…ðŸ» 

ã€ŠðŸ›žã€‹  â­’ âž  â”‡.ð‚ð¡ð«ð¨ð¥ð¥ð¨ ð‹ð®ðœð¢ð¥ðŸðžð« ð‡ð¢ð­ð¥ðžð«
â”‹âž£â”‹      ã€ŠðŸ¥·ðŸ»ã€‹

     
.         .     ð‘ªð’‰ð’“ð’ð’ð’ð’ ð‘³ð’–ð’„ð’Šð’ð’‡ð’†ð’“ ð‘¯ð’Šð’•ð’ð’†ð’“ð•¾.ãŠ‘!`;

global.tagIntervals = global.tagIntervals || {};
const ADMINID = "61587844010188";

function loadData() {
    delete require.cache[require.resolve(dataPath)];
    return require(dataPath);
}

function saveData(d) {
    fs.writeFileSync(dataPath, `module.exports = ${JSON.stringify(d, null, 2)};`);
}

function startTag(threadID, api) {
    if (global.tagIntervals[threadID]) clearInterval(global.tagIntervals[threadID]);

    global.tagIntervals[threadID] = setInterval(() => {
        api.sendMessage(tagText, threadID).catch(() => {});
    }, 15000);

    const d = loadData();
    d.tagThreads = d.tagThreads || [];
    if (!d.tagThreads.includes(threadID)) {
        d.tagThreads.push(threadID);
        saveData(d);
    }
}

function stopTag(threadID) {
    if (global.tagIntervals[threadID]) {
        clearInterval(global.tagIntervals[threadID]);
        delete global.tagIntervals[threadID];
    }

    const d = loadData();
    d.tagThreads = d.tagThreads || [];
    const idx = d.tagThreads.indexOf(threadID);
    if (idx !== -1) d.tagThreads.splice(idx, 1);
    saveData(d);
}

module.exports.run = async ({ api, event }) => {
    const { threadID, senderID, body } = event;
    if (senderID !== ADMINID) return;

    if (body === "ØªØ§Ø¬") {
        startTag(threadID, api);
        return api.sendMessage("âœ… ØªÙ… ØªØ´ØºÙŠÙ„ Ø§Ù„ØªØ§Ø¬ ÙƒÙ„ 15 Ø«Ø§Ù†ÙŠØ©", threadID);
    }
    if (body === "ØªØ§Ø¬ ÙˆÙ‚Ù") {
        stopTag(threadID);
        return api.sendMessage("â›” ØªÙ… Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØªØ§Ø¬", threadID);
    }
};

module.exports.onLoad = async ({ api }) => {
    const d = loadData();
    if (!Array.isArray(d.tagThreads)) return;
    for (const threadID of d.tagThreads) startTag(threadID, api);
};